import React, { Component } from "react";

export default class InfoList extends Component {
    state = {
        editing: null
    }

    toggleEditing = (itemId) => {
        this.setState((prevState, props) => { prevState.editing = itemId })
    }

    handleEditField = event => {
        if (event.keyCode === 13) {
            const target = event.target;
            let update = {};

            update._id = this.state.editing;
            update[target.name] = target.value;

            this.handleUpdate(update);
        }
    }

    handleEditItem = () => {
        let itemId = this.state.editing;

        this.handleUpdate({
            _id: itemId,
            value: this.refs[`value_${itemId}`].value,
        });
    }

    handleUpdate = (update) => {
        this.props.updateItem(update);
        this.setState((prevState, props) => { prevState.editing = null })
    }

    removeItem = item => {
        this.props.removeInfo(item);
    }

    renderItemOrEditField = item => {
        const { removeItem } = this.props;

        if (this.state.editing === item._id) {
            return (<tr key={`editing-${item._id}`}>
                <td>
                    <input
                        onKeyDown={(event) => this.handleEditField(event)}
                        type="text"
                        className="form-control"
                        ref={`value_${item._id}`}
                        name="value"
                        defaultValue={item.value}
                    />
                </td>
                <td>
                    <button
                        className="btn btn-default"
                        onClick={() => this.handleEditItem()}
                    >Update</button>
                </td>
            </tr>);
        } else {
            return (<tr
                key={item._id}
                onClick={() => this.toggleEditing(item._id)}
            >
                <td>{item.value}</td>
                <td>
                    <button
                        className="btn btn-default"
                        onClick={() => removeItem(item)}
                    >Remove</button>
                </td>
            </tr>);
        }
    }

    render() {
        const { info } = this.props;

        return (
            <table className="table">
                <thead>
                    <tr>
                        <td>Information</td>
                        <td className="width-15"></td>
                    </tr>
                </thead>
                <tbody>
                    {info.map(item => { return this.renderItemOrEditField(item); })}
                </tbody>
            </table>
        );
    }
}